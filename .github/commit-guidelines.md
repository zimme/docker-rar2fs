# Commit Message Guidelines

## Overview
This repository follows conventional commit patterns with a focus on automated updates and clear change descriptions.

## Commit Categories

### Automated Updates (GitHub Actions)
These are generated by automated workflows:

```
Update Dockerfile ARG values: rar={version}, rar2fs={version}
```

**Pattern**: Always update both versions simultaneously
**Scope**: Dockerfile ARG declarations only
**Trigger**: Daily workflow checking for new releases

### Manual Changes

#### Version Updates (Manual)
```
Update Alpine base image to 3.21.3
Update UnRAR to version 7.1.11
Update rar2fs to version 1.29.8
```

#### Build Improvements
```
Optimize Docker build caching
Improve multi-stage build efficiency
Add build argument for custom FUSE options
Reduce final image size by 15MB
```

#### Security Enhancements
```
Add security recommendations to README
Improve FUSE capability documentation  
Enhance AppArmor compatibility notes
Remove unnecessary build dependencies
```

#### Workflow Updates
```
Add ARM64 build support to CI
Improve GitHub Actions caching strategy
Update workflow dependencies to latest versions
Add automated security scanning
```

#### Documentation
```
Update README with new Docker Compose example
Fix typo in FUSE mount instructions
Add troubleshooting section for common issues
Improve security documentation
```

#### Bug Fixes
```
Fix build failure on ARM64 architecture
Resolve FUSE mount permission issues
Correct health check command syntax
Fix volume mount propagation in examples
```

## Message Structure

### Format
```
<type>: <description>

[optional body explaining the change]
[optional footer with issue references]
```

### Types
- **Update**: Version bumps, dependency updates
- **Add**: New features, capabilities, or files
- **Fix**: Bug fixes, corrections
- **Improve**: Enhancements, optimizations
- **Remove**: Deletions, cleanup
- **Refactor**: Code restructuring without functional changes

### Examples

#### Good Commit Messages
```
✓ Update Dockerfile ARG values: rar=7.1.10, rar2fs=1.29.7
✓ Add health check for FUSE mount verification
✓ Fix ARM64 build compilation errors
✓ Improve Docker build caching strategy
✓ Remove deprecated workflow steps
```

#### Poor Commit Messages
```
✗ update stuff
✗ fix
✗ WIP
✗ trying something
✗ oops
```

## Scope Guidelines

### What Should Be Atomic
- Single version updates (both rar + rar2fs together)
- Single workflow file changes
- Single documentation file updates
- Single Dockerfile optimization

### What Should Be Separate Commits
- Version updates vs. documentation updates
- Build changes vs. runtime changes
- Security changes vs. feature additions
- Workflow changes vs. Dockerfile changes

## Special Considerations

### Automated Commits
- Always include both version numbers in automated updates
- Use consistent format for parsing by other tools
- Include the specific versions in the commit message

### Breaking Changes
```
BREAKING: Change default FUSE options

Remove --seek-length=1 from default CMD to improve compatibility
with certain RAR files.

BREAKING CHANGE: Users relying on seek-length behavior need to
explicitly add this option to their docker run commands.
```

### Security Fixes
```
Security: Fix privilege escalation in FUSE mount

Ensure container runs with minimal required capabilities.
See SECURITY.md for details.
```

## Commit Body Guidelines

### When to Include Body
- Breaking changes (always)
- Security fixes (always)
- Complex changes requiring explanation
- Changes affecting user workflows

### Body Format
- First line: concise summary (50 chars max)
- Blank line
- Detailed explanation (72 chars per line)
- Include rationale for the change
- Mention any side effects or considerations

### Example with Body
```
Add multi-platform build support

Enable building for both linux/amd64 and linux/arm64 architectures
using Docker buildx. This allows users on ARM-based systems like
Apple Silicon and Raspberry Pi to use the image natively.

The build process now takes longer but provides better performance
for ARM users compared to emulation.
```

## Integration with Tools

### GitHub Actions
Commits trigger different workflows:
- `main` branch: Build and publish images
- Version updates: May trigger additional validations

### Dependabot
Automated dependency updates follow this pattern:
```
Bump alpine from 3.21.1 to 3.21.2

Bumps alpine from 3.21.1 to 3.21.2.
```

### Conventional Commits
While not strictly following conventional commits, we maintain:
- Consistent type prefixes
- Clear, actionable descriptions  
- Proper scope indication
- Breaking change notation

## Review Guidelines

### Self-Review Checklist
- [ ] Commit message clearly describes the change
- [ ] Scope is appropriate (not too broad, not too narrow)
- [ ] Breaking changes are clearly marked
- [ ] Version numbers are accurate and consistent
- [ ] Security implications are noted if relevant

### Team Review Focus
- Verify version accuracy in updates
- Check for proper scope separation
- Ensure breaking changes are documented
- Validate security considerations

This structure helps maintain clear project history and enables effective automated tooling integration.